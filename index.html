<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="index.css">
    <title>79</title>
</head>

<body>
    <div id="notification" class="hidden">
        <p id="message"></p>
        <button id="close-button" onClick="closeNotification()">
            Close
        </button>
        <button id="restart-button" onClick="restartApp()" class="hidden">
            Restart
        </button>
    </div>
    <h1 class="emodjis">üè´ üñ•Ô∏è üñáÔ∏è</h1>
    <h2 class="status"><span>‚òëÔ∏è</302span> –ó–∞–≥—Ä—É–∑–∫–∞...</h2>
    <h3 class="room">–ö–∞–±—ñ–Ω–µ—Ç: </h3>
    <h6 class="copyright">Copyright (c) 2019 Misha Marinenko</h6>
    <h6 class="copyright_help">Some Help and Tests by: Arseiy Galuskin, Dmitry Borisenko</h6>
    <pre>
        # Nearby Machines
    </pre>
</body>
<script>
    const { ipcRenderer } = require("electron");
    const { version } = require("./package.json");
    let updateInfo = async () => {
        const Status = await fetch("http://localhost:7979/status");
        const res = await Status.json();
        const net = await fetch("http://localhost:7979/net");
        const NetRes = await net.json();
        const machines = await fetch("http://localhost:7979/machines");
        const machinesRes = await machines.json();
        const status = document.querySelector(".status");
        const room = document.querySelector(".room");
        const machinesEl = document.querySelector("pre");
        console.log(Status, res);
        if (res.started == true) {
            status.innerHTML = "<span>‚úÖ</span> –ü—ñ–¥'—î–¥–Ω–∞–Ω–æ –î–æ –ú–µ—Ä–µ–∂—ñ –ö–æ–º–ø'—é—Ç–µ—Ä—ñ–≤ –õ—ñ—Ü–µ—é.";
        } else {
            status.innerHTML = `
                <span>‚ùå</span> –ù–µ –ø—ñ–¥'—î–¥–Ω–∞–Ω–æ –î–æ –ú–µ—Ä–µ–∂—ñ –ö–æ–º–ø'—é—Ç–µ—Ä—ñ–≤ –õ—ñ—Ü–µ—é.
                <br>
                <h6>
                 –¶–µ –ü—Ä–æ–≥—Ä–∞–º–Ω–µ –ó–∞–±–µ—Å–ø–µ—á–µ–Ω–Ω—è –ø—Ä–∞—Ü—é—î –∑–∞–≤–¥—è–∫–∏ P2P –¥–ª—è —Ä–æ–±–æ—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–µ–∫—ñ–ª—å–∫–∞ (1-2) –∫–æ–º–ø'—é—Ç–µ—ñ–≤.
                </h6>
            `;
        }
        room.innerHTML = "üö™–ö–∞–±—ñ–Ω–µ—Ç: " + NetRes.name;
        machinesEl.innerHTML = "";
        machinesRes.forEach(machine => {
            machinesEl.innerHTML = machinesEl.innerHTML + "\n" + machine.hostname;
        });
    };
    updateInfo();
    setInterval(updateInfo, 10000);
    const notification = document.getElementById('notification');
    const message = document.getElementById('message');
    const restartButton = document.getElementById('restart-button');
    ipcRenderer.send('app_version');
    ipcRenderer.on('app_version', (event, arg) => {
        ipcRenderer.removeAllListeners('app_version');
        console.log('Version ' + arg.version);
    });

    ipcRenderer.on('update_available', () => {
        ipcRenderer.removeAllListeners('update_available');
        message.innerText = '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ... –°–∫–∞—á–∏–≤–∞—é...';
        notification.classList.remove('hidden');
    });
    ipcRenderer.on('update_downloaded', () => {
        ipcRenderer.removeAllListeners('update_downloaded');
        message.innerText = '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–Ω–µ–Ω–æ. –ü–µ—Ä–µ–∑–ø—É—Å—Ç–∏—Ç—å?';
        restartButton.classList.remove('hidden');
        notification.classList.remove('hidden');
    });
    function closeNotification() {
        notification.classList.add('hidden');
    }
    function restartApp() {
        ipcRenderer.send('restart_app');
    }
</script>

</html>